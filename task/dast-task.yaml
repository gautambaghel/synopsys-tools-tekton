apiVersion: tekton.dev/v1alpha1
kind: Task
metadata:
  name: dast
spec:
  workspaces:
  - name: maven-repo
  inputs:
    resources:
      - name: source
        type: git
    inputs:
      params:
      - name: API_SECRET_KEY
        description: The secret API key generated from Tinfoil
        type: string
      - name: API_ACCESS_KEY
        description: The API access key generated from Tinfoil
        type: string
      - name: SITE_ID
        description: The ID of the site to be scanned
        type: string
      - name: SEVERITY_THRESHOLD
        description: The Severity threashold to break the build
        type: string
      - name: POLL_WINDOW
        description: The poll window when quering Tinfoil APIs
        type: string
      resources:
      - name: source
        type: git
  steps:
    - name: scan
      image: docker.io/gautambaghel/tinfoil:latest
      workingDir: /workspace/source
      env:
      - name: "TOKEN"
        value: "$(params.API_SECRET_KEY)"
      - name: "ACCESS_KEY"
        value: "$(params.API_ACCESS_KEY)"
      - name: "SITE_ID"
        value: "$(params.SITE_ID)"
      - name: "SEVERITY_THRESHOLD"
        value: "$(params.SEVERITY_THRESHOLD)"
      - name: "POLL_WINDOW"
        value: "$(params.POLL_WINDOW)"
      